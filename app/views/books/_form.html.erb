<%= form_with(model: @book) do |f| %>
    <%= f.label :title %><br>
    <%= f.text_field :title %><br>
    <%= f.label :category %><br>
    <%= f.text_field :category %><br>
    <%= f.label :description %><br>
    <%= f.text_area :description %><br>
    <%= f.hidden_field :author_id, value: @author.id %>

    <%= f.submit "Submit" %>
<%end%>
<p id="author-id" data-id=<%=@author.id%>></div>

<script type="text/javascript">



$(function() {

    $('form').on('submit', submitForm)

})


function submitForm(e) {
        e.preventDefault()
        const id = $('#author-id').attr('data-id')
        console.log(id)
        const values = $(this).serialize()
        posting = $.post('/books', values)
        .done(function(values) {
            getCurrentBooks()
            $('form').trigger('reset')
        })
        console.log('done')
}




function getCurrentBooks() {
    const id = $('#author-id').attr('data-id')
    posting = $.getJSON('/authors/'+id+'book_data', function(data) {
        const book = data["books"]
        const newBook = book[book.length-1]["title"]
        $("#new-books").append('<p>'+newBook+'</p>')
})

}








</script>
