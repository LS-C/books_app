<%= form_for @book, :html => {:class => "ui form"}  do |f| %>
    <%= f.label :title %><br>
    <%= f.text_field :title, class: "field"%><br>
    <%= f.label :category %><br>
    <%= f.text_field :category, class: "field" %><br>
    <%= f.label :description %><br>
    <%= f.text_area :description,  class: "field" %><br>
    <%= f.hidden_field :author_id, value: @author.id %>

    <%= f.submit "Submit" %>
<%end%>
<p id="author-id" data-id=<%=@author.id%>></div>

<script type="text/javascript">




    $('form').submit(submitForm)




function submitForm(e) {
        e.preventDefault()
        const id = $('#author-id').attr('data-id')
        console.log('this is working here')
        const values = $(this).serialize()
        console.log(values)
        posting = $.post('/books', values)
        .done(function(values) {
            getNewBooks()
            $('form').trigger('reset')
            $('#book-form').empty()
        })
        console.log('done')
}


function getNewBooks() {
    const id = $('#author-id').attr('data-id')
    let title;
    posting = $.getJSON('/authors/'+id+'book_data', function(data) {
        const book = data["books"]
        const newBook = book[book.length-1]["title"]
        title = titleCase(newBook)
        console.log(title)
        const id = book[book.length-1]["id"]
        $("#authors-books").append(`<div class="four wide column"><a href="/books/${id}" class="book-link">`+title+'</a></div><br/>')
      })
}


function titleCase(title) {
  if (title.indexOf(' ') === -1) {
    return title.charAt(0).toUpperCase()+title.slice(1)
  } else{
    return title.split(" ").map( word => { return word.charAt(0).toUpperCase()+word.slice(1) }).join(" ")
  }
}

</script>
